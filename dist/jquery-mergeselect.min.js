"use strict";!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){function i(i){i.find(".option:not(.hidden)").each(function(t,n){e(n).attr("data-index",t),i.find(".option").removeClass("hl")}),i.find(".search input").focus(),window[n].idx=-1}function t(e){var i=e.find(".options"),t=e.find(".option.hl"),n=t.offset().top+i.scrollTop(),s=n+t.outerHeight(),d=i.offset().top+i.scrollTop(),o=d+i.outerHeight();if(s>o){var a=i.scrollTop()+s-o;i.scrollTop(a)}else if(d>n){var a=i.scrollTop()-d-n;i.scrollTop(a)}}var n="mergeSelect",s="."+n+" ",d=function(e){return function(){return n+"-"+ ++e}}(0),o=function(){var i=this.settings,t=[];if(this.$wrap.find(".option.selected").each(function(i,n){t.push(e(n).find(".option-label").text())}),t.length<1)t=i.placeholder;else if(t.length>i.numDisplayed){var n=i.overflowText;"function"==typeof n&&(n=n.apply(this,[t])),t=n.replace("{n}",t.length)}else t=t.join(", ");return t},a={selects:null,placeholder:"Select some options",numDisplayed:3,overflowText:"{n} selected",labelText:o},l=function(i,t){this.el=i,this.$el=e(i),this.settings=t,this.selects=t.selects,this.$selects=e(this.selects),this.selects_map={};var n=this.selects_map;this.$selects.each(function(i,t){t.id||(t.id=d()),n[t.id]=e(t)}),this.create()};l.prototype={create:function(){var e=this.$selects.is("[multiple]")?" multiple":"";this.$el.append('<div class="'+n+'"></div>');var i=this.$el.find("."+n);i.append('<div class="wrap'+e+'"></div>');var t=i.find(".wrap");t.append('<div class="label-wrap"><div class="label">'+this.settings.placeholder+'</div><span class="arrow"></span></div>'),t.append('<div class="dropdown hidden"><div class="options"></div></div>'),t.addClass("hidden"),this.$container=i,this.$wrap=t,this.reload()},reload:function(){var i=this;if(this.settings.showSearch){var t='<div class="search"><input type="search" placeholder="'+this.settings.searchText+'" /></div>';this.$wrap.find(".dropdown").prepend(t)}var n="";this.$selects.each(function(t,s){n+=i.buildOptions(e(s))}).get(),this.$wrap.find(".options").html(n),this.reloadDropdownLabel()},buildOptions:function(i){var t=this,n="",s=i.closest("select"),d=s.is("[multiple]");return("select"==i.tagName||i.data("label"))&&(n+='<div class="optgroup">',n+='<div class="optgroup-label">'+i.data("label")+"</div>",n+="</div>"),i.children().each(function(i,o){var a=e(o);if("optgroup"==a.prop("nodeName").toLowerCase())n+='<div class="optgroup">',n+='<div class="optgroup-label">'+a.prop("label")+"</div>",n+=t.buildOptions(a),n+="</div>";else{var l=a.is(":selected")?" selected":"",c=l?'checked="checked"':"",p=d?"checkbox":"radio";n+='<div class="option'+l+'" data-value="'+a.prop("value")+'"data-select-id="'+s.prop("id")+'"><div class="option-label"><input type="'+p+'"'+c+'"/>'+a.html()+"</div></div>"}}),n},reloadDropdownLabel:function(){var i=this.settings.labelText.apply(this);this.$wrap.find(".label").html(i),this.$selects.each(function(i,t){e(t).change()})}},e.fn[n]=function(i){var t=e.extend(a,i);return this.each(function(){var i=e(this).find(s),d=i.data(n);d||(d=new l(this,t),d.$container.data(n,d)),"string"==typeof t&&d[t]()})},window[n]={active:null,idx:-1},e(document).on("click",s+".option",function(){var i=e(this),t=i.closest(".wrap"),d=t.closest(s),o=d.data(n),a={};e.map(o.selects_map,function(e,i){a[i]=null});var l=t.hasClass("multiple");if(!l){var c=i.data("select-id");t.find(".option[data-select-id='"+c+"']").removeClass("selected").find("input").prop("checked",null),i.addClass("selected").find("input").prop("checked",!0),t.find(".dropdown").addClass("hidden")}l&&(i.toggleClass("selected"),i.find("input").prop("checked",i.hasClass("selected"))),t.find(".option.selected").each(function(i,t){var n=e(t),s=a[n.data("select-id")]||[];s.push(n.data("value")),a[n.data("select-id")]=s}),e.map(a,function(e,i){var t=o.selects_map[i];t.val(e),o.reloadDropdownLabel()})}),e(document).on("keyup",s+".search input",function(t){if(40==t.which)return void e(this).blur();var n=e(this).closest(".wrap"),s=e(this).val();n.find(".option, .optgroup-label").removeClass("hidden"),""!=s&&(n.find(".option").each(function(){var i=new RegExp(s,"gi");null===e(this).find(".option-label").text().match(i)&&e(this).addClass("hidden")}),n.find(".optgroup-label").each(function(){var i=e(this).closest(".optgroup").find(".option:not(.hidden)").length;1>i&&e(this).addClass("hidden")})),i(n)}),e(document).on("click",function(t){var s=e(t.target),d=s.closest(".wrap");if(0<d.length){if(s.hasClass("label")){window[n].active=d;var o=d.find(".dropdown").hasClass("hidden");e(".dropdown").addClass("hidden"),o?d.find(".dropdown").removeClass("hidden"):d.find(".dropdown").addClass("hidden"),i(d)}}else e(".dropdown").addClass("hidden"),window[n].active=null}),e(document).on("keydown",function(i){var s=window[n].active;if(null!==s)if(38==i.which)i.preventDefault(),s.find(".option").removeClass("hl"),window[n].idx>0?(window[n].idx--,s.find(".option[data-index="+window[n].idx+"]").addClass("hl"),t(s)):(window[n].idx=-1,s.find(".search input").focus());else if(40==i.which){i.preventDefault();var d=s.find(".option:last").attr("data-index");window[n].idx<parseInt(d)&&(window[n].idx++,s.find(".option").removeClass("hl"),s.find(".option[data-index="+window[n].idx+"]").addClass("hl"),t(s))}else 32==i.which||13==i.which?s.find(".option.hl").click():27==i.which&&(e(".dropdown").addClass("hidden"),window[n].active=null)})});
//# sourceMappingURL=jquery-mergeselect.min.js.map
