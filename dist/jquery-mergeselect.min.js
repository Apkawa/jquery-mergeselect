"use strict";!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){function s(s){s.find(".ms-option:not(.hidden)").each(function(i,t){e(t).attr("data-index",i),s.find(".ms-option").removeClass("ms-hl")}),s.find(".ms-search input").focus(),window[t].idx=-1}function i(e){var s=e.find(".ms-options"),i=e.find(".ms-option.ms-hl"),t=i.offset().top+s.scrollTop(),n=t+i.outerHeight(),d=s.offset().top+s.scrollTop(),o=d+s.outerHeight(),a=null;n>o?(a=s.scrollTop()+n-o,s.scrollTop(a)):d>t&&(a=s.scrollTop()-d-t,s.scrollTop(a))}var t="mergeSelect",n="."+t+" ",d=function(e){return function(){return t+"-"+ ++e}}(0),o=function(){var s=this.settings,i=[];if(this.$wrap.find(".ms-option.ms-selected").each(function(s,t){i.push(e(t).find(".ms-option-label").text())}),i.length<1)i=s.placeholder;else if(i.length>s.numDisplayed){var t=s.overflowText;"function"==typeof t&&(t=t.apply(this,[i])),i=t.replace("{n}",i.length)}else i=i.join(", ");return i},a={selects:null,placeholder:"Select some options",numDisplayed:3,overflowText:"{n} selected",labelText:o},l=function(s,i){this.el=s,this.$el=e(s),this.settings=i,this.selects=i.selects,this.$selects=e(this.selects),this.selects_map={};var t=this.selects_map;this.$selects.each(function(s,i){i.id||(i.id=d()),t[i.id]=e(i)}),this.create()};l.prototype={create:function(){var e=this.$selects.is("[multiple]")?" multiple":"";this.$el.append('<div class="'+t+'"></div>');var s=this.$el.find("."+t);s.append('<div class="ms-wrap'+e+'"></div>');var i=s.find(".ms-wrap");i.append('<div class="ms-label-wrap"><div class="ms-label">'+this.settings.placeholder+'</div><span class="ms-arrow"></span></div>'),i.append('<div class="ms-dropdown hidden"><div class="ms-options"></div></div>'),this.$container=s,this.$wrap=i,this.reload()},reload:function(){var s=this;if(this.settings.showSearch){var i='<div class="ms-search"><input type="search" placeholder="'+this.settings.searchText+'" /></div>';this.$wrap.find(".ms-dropdown").prepend(i)}var t="";this.$selects.each(function(i,n){t+=s.buildOptions(e(n))}).get(),this.$wrap.find(".ms-options").html(t),this.reloadDropdownLabel()},buildOptions:function(s){var i=this,t="",n=s.closest("select"),d=n.is("[multiple]");return("select"==s.tagName||s.data("label"))&&(t+='<div class="ms-optgroup">',t+='<div class="ms-optgroup-label">'+s.data("label")+"</div>",t+="</div>"),s.children().each(function(s,o){var a=e(o);if("optgroup"==a.prop("nodeName").toLowerCase())t+='<div class="ms-optgroup">',t+='<div class="ms-optgroup-label">'+a.prop("label")+"</div>",t+=i.buildOptions(a),t+="</div>";else{var l=a.is(":selected")?" selected":"",c=l?'checked="checked"':"",p=d?"checkbox":"radio";t+='<div class="ms-option'+l+'" data-value="'+a.prop("value")+'"data-select-id="'+n.prop("id")+'"><div class="ms-option-label"><input type="'+p+'"'+c+'"/>'+a.html()+"</div></div>"}}),t},reloadDropdownLabel:function(){var s=this.settings.labelText.apply(this);this.$wrap.find(".ms-label").html(s),this.$selects.each(function(s,i){e(i).change()})}},e.fn[t]=function(s){var i=e.extend(a,s);return this.each(function(){var s=e(this).find(n),d=s.data(t);d||(d=new l(this,i),d.$container.data(t,d)),"string"==typeof i&&d[i]()})},window[t]={active:null,idx:-1},e(document).on("click",n+".ms-option",function(){var s=e(this),i=s.closest(".ms-wrap"),d=i.closest(n),o=d.data(t),a={};e.map(o.selects_map,function(e,s){a[s]=null});var l=i.hasClass("multiple");if(!l){var c=s.data("select-id");i.find(".option[data-select-id='"+c+"']").removeClass("ms-selected").find("input").prop("checked",null),s.addClass("ms-selected").find("input").prop("checked",!0),i.find(".ms-dropdown").addClass("hidden")}l&&(s.toggleClass("ms-selected"),s.find("input").prop("checked",s.hasClass("ms-selected"))),i.find(".ms-option.selected").each(function(s,i){var t=e(i),n=a[t.data("select-id")]||[];n.push(t.data("value")),a[t.data("select-id")]=n}),e.map(a,function(e,s){var i=o.selects_map[s];i.val(e),o.reloadDropdownLabel()})}),e(document).on("keyup",n+".ms-search input",function(i){if(40==i.which)return void e(this).blur();var t=e(this).closest(".ms-wrap"),n=e(this).val();t.find(".ms-option, .ms-optgroup-label").removeClass("hidden"),""!=n&&(t.find(".ms-option").each(function(){var s=new RegExp(n,"gi");null===e(this).find(".ms-option-label").text().match(s)&&e(this).addClass("hidden")}),t.find(".ms-optgroup-label").each(function(){var s=e(this).closest(".ms-optgroup").find(".option:not(.hidden)").length;1>s&&e(this).addClass("hidden")})),s(t)}),e(document).on("click",function(i){var n=e(i.target),d=n.closest(".ms-wrap");if(0<d.length){if(n.hasClass("ms-label")){window[t].active=d;var o=d.find(".ms-dropdown").hasClass("hidden");e(".ms-dropdown").addClass("hidden"),o?d.find(".ms-dropdown").removeClass("hidden"):d.find(".ms-dropdown").addClass("hidden"),s(d)}}else e(".ms-dropdown").addClass("hidden"),window[t].active=null}),e(document).on("keydown",function(s){var n=window[t].active;if(null===n)return null;if(38==s.which)s.preventDefault(),n.find(".ms-option").removeClass("hl"),window[t].idx>0?(window[t].idx--,n.find(".ms-option[data-index="+window[t].idx+"]").addClass("hl"),i(n)):(window[t].idx=-1,n.find(".ms-search input").focus());else if(40==s.which){s.preventDefault();var d=n.find(".ms-option:last").attr("data-index");window[t].idx<parseInt(d)&&(window[t].idx++,n.find(".ms-option").removeClass("ms-hl"),n.find(".ms-option[data-index="+window[t].idx+"]").addClass("hl"),i(n))}else 32==s.which||13==s.which?n.find(".ms-option.ms-hl").click():27==s.which&&(e(".ms-dropdown").addClass("ms-hidden"),window[t].active=null)})});
//# sourceMappingURL=jquery-mergeselect.min.js.map
